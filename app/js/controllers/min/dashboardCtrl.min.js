module.exports=function(e,n,a,o,s,t){function r(e){n.message=e,$(".popup_message").addClass("flash_popup"),t(function(){$(".popup_message").removeClass("flash_popup")},3e3)}function m(){l.currentUser=a.getUser(),void 0===l.currentUser.username&&i()}function i(){var e=o.search();void 0!==e.username?""!=e.username&&""!=e.token&&(a.setUser(e.username,e.token),m()):s.go("login")}var l=n;l.games=[],l.myGames=[],l.gameTemplates=[],n.newGame=[],n.newGameWindow_hidden=!0,e.getGameTemplates({onSuccess:function(e){angular.forEach(e.data,function(e,a){l.gameTemplates[a]=e.id,n.newGame.gameTemplate=l.gameTemplates[0]})},onError:function(e){r("Something went wrong with getting the templates"),console.log(e)}}),l.getAllGames=function(){e.getAllGames({onSuccess:function(e){angular.forEach(e.data,function(n,a){if(e.data[a].createdBy._id==l.currentUser.username)l.myGames[a]=n;else for(var o=0;o<e.data[a].players.length;o++)e.data[a].players[o]._id==l.currentUser.username?l.myGames[a]=n:l.games[a]=n})},onError:function(e){r("Something went wrong with getting the games"),console.log(e)}})},m(),n.getAllGames(),l.joinGame=function(n){return n.players.length>=n.maxPlayers?(r("This game is full!"),void 0):(e.joinGame(n._id,{onSuccess:function(e){console.log(e),r("Game joined!"),l.getAllGames()},onError:function(e){console.log(e),r("Something went wrong with joining the game")}}),void 0)},l.openNewGame=function(){n.newGameWindow_hidden=!1},l.createNewGame=function(){if(isNaN(n.newGame.maxPlayers)||isNaN(n.newGame.minPlayers))return r("Please fill in a number!"),void 0;var a=parseInt(n.newGame.maxPlayers),o=parseInt(n.newGame.minPlayers),s={templateName:n.newGame.gameTemplate,minPlayers:o,maxPlayers:a};console.log(s),e.createGame(JSON.stringify(s),{onSuccess:function(e){r("Your game has been created!"),console.log(e),n.newGameWindow_hidden=!0},onError:function(e){r("Woops! we failed to create you game"),console.log(e)}})}};