module.exports=function(e,a,n,o,t){function s(e){a.message=e,$(".popup_message").addClass("flash_popup"),t(function(){$(".popup_message").removeClass("flash_popup")},3e3)}var l=a;l.games=[],l.myGames=[],l.gameTemplates=[],a.newGame=[],a.currentUser=n.getUser(),a.newGameWindow_hidden=!0,e.getGameTemplates({onSuccess:function(e){angular.forEach(e.data,function(e,n){l.gameTemplates[n]=e.id,a.newGame.gameTemplate=l.gameTemplates[0]})},onError:function(e){s("Something went wrong with getting the templates"),console.log(e)}}),l.getAllGames=function(){e.getAllGames({onSuccess:function(e){angular.forEach(e.data,function(a,n){for(var o=0;o<e.data[n].players.length;o++)l.games[n]=a})},onError:function(e){s("Something went wrong with getting the games"),console.log(e)}})},l.getAllGamesByPlayer=function(){e.getAllGamesByPlayer(l.currentUser.username,{onSuccess:function(e){l.myGames=e.data,angular.forEach(e.data,function(a,n){for(var o=0;o<e.data.length;o++){for(var t=0;t<a.players.length;t++)a.players[t].name=a.players[t].name.split(" ")[0];l.myGames[n]=a}})},onError:function(e){s("Something went wrong with getting the games"),console.log(e)}})},a.getAllGames(),a.getAllGamesByPlayer(),l.joinGame=function(a){return a.players.length>=a.maxPlayers?(s("This game is full!"),void 0):(e.joinGame(a._id,{onSuccess:function(e){console.log(e),s("Game joined!"),l.getAllGames(),l.getAllGamesByPlayer()},onError:function(e){console.log(e),s("Something went wrong with joining the game")}}),void 0)},l.openNewGame=function(){a.newGameWindow_hidden=!1},l.createNewGame=function(){if(isNaN(a.newGame.maxPlayers)||isNaN(a.newGame.minPlayers))return s("Please fill in a number!"),void 0;var n=parseInt(a.newGame.maxPlayers),o=parseInt(a.newGame.minPlayers),t={templateName:a.newGame.gameTemplate,minPlayers:o,maxPlayers:n};e.createGame(JSON.stringify(t),{onSuccess:function(e){s("Your game has been created!"),console.log(e),a.newGameWindow_hidden=!0,l.getAllGames(),l.getAllGamesByPlayer()},onError:function(e){s("Woops! we failed to create you game"),console.log(e)}})}};